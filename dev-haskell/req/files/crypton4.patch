From c2bb3b16dd26445534045318b99975769d7eec8e Mon Sep 17 00:00:00 2001
From: Mark Karpov <markkarpov92@gmail.com>
Date: Mon, 20 May 2024 10:15:01 +0200
Subject: [PATCH] Allow crypton-connection-0.4

---
 Network/HTTP/Req.hs | 3 ++-
 req.cabal           | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/Network/HTTP/Req.hs b/Network/HTTP/Req.hs
index 9322046..2286e36 100644
--- a/Network/HTTP/Req.hs
+++ b/Network/HTTP/Req.hs
@@ -236,6 +236,7 @@ import Data.ByteString qualified as B
 import Data.ByteString.Lazy qualified as BL
 import Data.CaseInsensitive qualified as CI
 import Data.Data (Data)
+import Data.Default.Class (def)
 import Data.Function (on)
 import Data.IORef
 import Data.Kind (Constraint, Type)
@@ -606,7 +607,7 @@ globalManager = unsafePerformIO $ do
   let settings =
         L.mkManagerSettingsContext
           (Just context)
-          (NC.TLSSettingsSimple False False False)
+          (NC.TLSSettingsSimple False False False def)
           Nothing
   manager <- L.newManager settings
   newIORef manager
diff --git a/req.cabal b/req.cabal
index 5b5bdd2..7f2fa94 100644
--- a/req.cabal
+++ b/req.cabal
@@ -40,7 +40,8 @@ library
         bytestring >=0.10.8 && <0.13,
         case-insensitive >=0.2 && <1.3,
         containers >=0.5 && <0.7,
-        crypton-connection >=0.2.2 && <0.4,
+        crypton-connection >=0.4 && <0.5,
+        data-default-class,
         exceptions >=0.6 && <0.11,
         http-api-data >=0.2 && <0.7,
         http-client >=0.7.13.1 && <0.8,
